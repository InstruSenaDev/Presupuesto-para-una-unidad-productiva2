---
import { fetchProductos } from '../../js/getProducto.js'; // Asumimos que esta función obtiene los productos del servidor.

const productos  = fetchProductos();

// const productos = JSON.parse({JSON.stringify(fetchProductos)}""); // Pasar productos del servidor al cliente.
let seleccionados = [];
let total = 0;

// Función para actualizar el total de productos seleccionados
function actualizarTotal() {
  total = seleccionados.reduce(
    (sum, item) => sum + item.valorunitario * item.cantidad,
    0
  );
  document.getElementById("total-valor").textContent = `Total: $${total.toLocaleString()}`;
}

// Función para renderizar los productos seleccionados
function renderizarSeleccionados() {
  const lista = document.getElementById("seleccionados-lista");
  lista.innerHTML = "";

  seleccionados.forEach((item) => {
    const li = document.createElement("li");
    li.classList.add("flex", "justify-between", "items-center", "mb-2");
    li.innerHTML = `
      <span>${item.nombre}<br><small class="text-gray-500">${item.cantidad} Unidades x $${item.valorunitario}</small></span>
      <span class="text-indigo-700 font-bold">$${(item.valorunitario * item.cantidad).toLocaleString()}</span>
    `;
    lista.appendChild(li);
  });
}

// Evento para agregar productos a la lista de seleccionados
document.querySelectorAll(".plus-circle").forEach((button) => {
  button.addEventListener("click", () => {
    const index = button.getAttribute("data-index");
    const producto = productos[index];
    const existente = seleccionados.find(item => item.codigo === producto.codigo);

    if (existente) {
      existente.cantidad += 1;
    } else {
      seleccionados.push({ ...producto, cantidad: 1 });
    }

    actualizarTotal();
    renderizarSeleccionados();
  });
});

// Obtenemos los productos del usuario en el servidor (puede estar en el lado del servidor)
// const productos = async fetchProductos();
---

<!-- Tabla para mostrar los productos obtenidos -->
<div class="bg-white rounded-lg shadow-md p-2 w-full">
  <table class="w-full">
    <thead>
      <tr class="text-left text-indigo-700">
        <th class="text-center p-2 text-2xl font-bold">Nombre</th>
        <th class="text-center p-2 text-2xl font-bold">Numero de recibo</th>
        <th class="text-center p-2 text-2xl font-bold">Precio</th>
        <th class="text-center p-2 text-2xl font-bold">Estado</th>
        <th class="text-center p-2 text-2xl font-bold">Acciones</th>
      </tr>
    </thead>
    <tbody id="productos-tbody">
      {productos.map((producto, index) => (
        <tr class="border-t">
          <td class="text-center p-2">{producto.nombre}</td>
          <td class="text-center p-2">{producto.codigo}</td>
          <td class="text-center p-2">{producto.valorunitario}</td>
          <td class="text-center p-2">{producto.estado}</td>
          <td class="text-center pl-2">
            <button class="text-center font-bold plus-circle" data-index={index} id={`btn-${index}`}>
              <i class="bi bi-plus-circle" />
            </button>
          </td>
        </tr>
      ))}
    </tbody>
  </table>
</div>

<!-- Tabla de productos seleccionados -->
<div class="bg-white rounded-lg shadow-md w-96">
  <h2 class="bg-blueUwu text-xl text-center text-white font-bold mb-4 bg-indigo-700 text-white py-2 px-4 rounded-t-lg">
    Seleccionados
  </h2>
  <ul id="seleccionados-lista" class="p-6"></ul>
  <div class="mt-4 flex justify-between items-center bg-gris">
    <button id="pagar-btn" class="bg-negro text-white px-4 py-2 rounded-md">
      <i class="bi bi-currency-dollar"></i>Pagar
    </button>
    <span id="total-valor" class="pl-3 text-indigo-700 font-bold">Total: $0</span>
  </div>
</div>

<!-- Código JavaScript que se ejecutará en el cliente -->
<script >
</script>
